# WP2 Specify Integration - 2024-06-27

## Intro to Specify
Fedor gave us a short introduction to the Specify System and how they use it, he also went into detail on how they create an "Specify Attachment" aka an "ARS Asset".
After the short demo, we started to scope the integration. Bhupjit has split the task up into 3 parts, 

1. Sync ARS to Specify 
2. Sync Specify to ARS
3. RBAC for serving files

On this meeting we mostly focused on part 1.

## WP2A: ARS transfer to Specify (part 1 of 3)

### Glossary:
- "Specimen" (ARS) = "Collection Object" (Specify)
- "Asset" (ARS) = "Attachment" (Specify)

### Constraints
- Specify can't show asset "derivatives", so an "asset derivative" in the ARS is just a new attachment in Specify
- *We don't create "collection objects" in Specify, we only add "attachments" to existing "collections objects"* @Bhupjit can you verify this? 

### Requirements
As part 1 of the ARS to Specify integration, we will look at:
- When new assets are created by the digitisation process and added to the ARS, we want to sync the Asset metadata to Specify.
  - This can be done using the Specify Rest API
  - An asset is only synced to Specify, if the Specimen (Collection Object) already exists in Specify.
- When an asset is updated in the ARS, we also need to sync the changes to Specify.
  - This can be done using the Specify Rest API
  - An asset is only synced to Specify, if the Specimen (Collection Object) already exists in Specify
- We need public access to asset files, so that Specify can start using the FileProxy instead of the old Attachment Server.
  - This will also give external publishers access to the asset files
  - As for now there's no RBAC on this endpoint, it has been moved to part 3
- Our serving endpoint should be able to serve the thumbnail, if it exists.
  - The thumbnails are created by a post processing pipeline, created by the main DaSSCo Dev Team.
  - If it doesn't exist we will return the original on the "thumbnail request"

As we agreed on the meeting, Christoffer will create the tasks as Stories on the GitHub Project and notify Bhupjit afterwards.

## WP2B: Specify transfer to ARS (part 2 of 3)
This will be discussed further at a later date, but essentially WP2B will contain the Sync from Specify to ARS. So when an "Attachment" is added in the Specify UI, it will also be added in the ARS.

### Requirements (The original requirements, subject to change): 
- Be able to create assets in the ARS including metadata when a new attachment record is created in Specify. It should also be able to attach the attachment (asset) uploaded in Specify to the newly created asset in the ARS (including drawing on the linkage between the attachment and specimen records in Specify) to populate the ARS metadata. It should then update the Specify record, such that the asset can be viewed in Specify as well. This involves handling URLs generated by Specify for attachments and their thumbnails.
- Be able to connect the corresponding thumbnail generated in the pipeline, and save it as a new asset in the ARS. Note: Thumbnails should not be created as separate attachment records in Specify. They should be served on par with the original assets based on type requested (thumbnail or original).
- In case of uploading a new asset to an existing Specify specimen record that already has one or more assets associated with it, the new assets should be related correspondingly inside the ARS.
- In case the asset metadata fields that belong in ARS are updated in Specify, they should be synchronised in ARS.


## WP2C: RBAC on FileProxy "File Serving" (part 3 of 3)
This will be discussed further at a later date, but essentially WP2C will wetup Role Based Access to Asset files on FileProxy. So it's possible to setup restrictions for who can see which asset files.

### Requirements (The original requirements, subject to change):
- Be able to provide an alternative way to serve higher-res sets to users of the system and external users. For example, when publishing data to external publishers like GBIF through Specify, a given asset can be set to be not public. In that case, the system should not publish that asset for that specimen record. We still want to sign-post that we have this aYachment and publish its metadata but not the asset itself externally. An authenticated user should be able to download that hi-res image from Specify directly but external or anonymous users should be restricted to having to request access to that image from relevant staff.
- Be able to provide access based on the access rights of the user, meaning normally everyone would have read permission to view assets but in case some assets require permission to view or download, this should be possible.
